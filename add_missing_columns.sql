-- Add missing columns to existing sbir_database table
-- Run this in Supabase SQL Editor

-- Add all missing columns one by one
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "component_full_name_derived:_expanded_from_component_abbreviation" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "solicitation_phase_derived:_extracted_from_cyclename_using_regex" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "proposal_window_status_calculated:_based_on_current_date_vs_start/end_dates" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "pre_release_duration_calculated:_prereleaseenddate__prereleasestartdate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "last_activity_date_calculated:_max_of_updateddate,_modifieddate,_topicqaenddate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "q&a_window_active_calculated:_current_date_within_qa_start/end_range" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "unpublished_questions_calculated:_topicquestioncount__noofpublishedquestions" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "q&a_response_rate_calculated:_publishedquestions/totalquestions_percentage" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "q&a_last_updated_extracted:_latest_answeredon_date_from_q&a_responses" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "technology_areas_count_calculated:_count_of_comma_separated_values" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "modernization_priority_count_calculated:_count_of_pipe_separated_values" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "security_clearance_required_text_analysis:_keywords_in_description" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "phase_i_description_api:_details.phase1description_with_html_removed" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "phase_ii_description_api:_details.phase2description_with_html_removed" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "phase_iii_dual_use_api:_details.phase3description_with_html_removed" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "is_direct_to_phase_ii_text_analysis:_dp2_or_direct_to_phase_ii_in_text" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "phase_funding_text_extraction:_dollar_amounts_from_phase_descriptions" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "award_amount_phase_i_text_extraction:_dollar_amount_from_phase1description" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "award_amount_phase_ii_text_extraction:_dollar_amount_from_phase2description" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "award_duration_phase_i_text_extraction:_months_from_phase1description" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "award_duration_phase_ii_text_extraction:_months_from_phase2description" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "total_potential_award_calculated:_sum_of_all_phase_amounts_found" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "topic_pdf_download_generated:_/topics/api/public/topics/{id}/download/pdf" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "solicitation_instructions_download_generated:_/submissions/api/public/download_url" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "solicitationinstructionsurl_generated:_solicitation_download_duplicate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "component_instructions_download_generated:_component_specific_download_url" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "componentinstructionsurl_generated:_component_download_duplicate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "has_solicitation_instructions_derived:_1_if_solicitation_link_exists" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "component_instructions_version_api:_baainstructions_filename_match" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "competition_level_estimated:_based_on_historicalawards_thresholds" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "baa_instruction_files_api:_baainstructions.filename_array_joined" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "has_special_requirements_text_analysis:_special_keywords_detected" TEXT;

-- Add any other missing columns that might be needed
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "topic_number_api:_topiccode" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "topic_id_api:_topicid" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "title_api:_topictitle" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "short_title_derived:_first_50_chars_of_topictitle" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "component_api:_component" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "command_api:_command" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "program_api:_program" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "program_type_derived:_extracted_from_program_field" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "solicitation_api:_solicitationtitle" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "solicitation_number_api:_solicitationnumber" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "cycle_name_api:_cyclename" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "release_number_api:_releasenumber" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "status_api:_topicstatus" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "topic_status_api:_topicstatus_duplicate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "days_until_close_calculated:_topicenddate__current_date" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "days_since_open_calculated:_current_date__topicstartdate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "urgency_level_calculated:_based_on_days_until_close_thresholds" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "open_date_api:_topicstartdate_converted_to_mm/dd/yyyy" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "close_date_api:_topicenddate_converted_to_mm/dd/yyyy" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "open_datetime_api:_topicstartdate_duplicate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "close_datetime_api:_topicenddate_duplicate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "duration_days_calculated:_topicenddate__topicstartdate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "pre_release_start_api:_topicprereleasestartdate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "pre_release_end_api:_topicprereleaseenddate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "created_date_api:_createddate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "updated_date_api:_updateddate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "modified_date_api:_modifieddate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "q&a_start_api:_topicqastartdate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "q&a_end_api:_topicqaenddate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "q&a_tpoc_start_api:_topicqatpocstartdate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "q&a_tpoc_end_api:_topicqatpocenddate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "q&a_status_api:_topicqastatus" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "q&a_status_display_api:_topicqastatusdisplay" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "q&a_open_api:_topicqaopen_boolean" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "days_until_q&a_close_calculated:_topicqaenddate__current_date" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "total_questions_api:_topicquestioncount" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "published_questions_api:_noofpublishedquestions" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "hasqa_derived:_1_if_topicquestioncount_>_0" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "qa_data_api:_topicquestioncount_duplicate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "q&a_content_fetched:_from_/questions_endpoint_and_formatted" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "technology_areas_api:_details.technologyareas_array_joined" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "primary_technology_area_derived:_first_item_in_technologyareas" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "tech_modernization_api:_details.focusareas_mapped" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "modernization_priorities_api:_details.focusareas_array_joined" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "keywords_api:_details.keywords" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "keywords_count_calculated:_count_of_semicolon_separated_values" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "primary_keyword_derived:_first_keyword_before_semicolon" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "itar_controlled_api:_details.itar_boolean_to_yes/no" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "requiresitar_derived:_1_if_itar_is_yes_else_0" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "security_export_api:_details.itar_duplicate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "objective_api:_details.objective_with_html_removed" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "objective_word_count_calculated:_space_separated_word_count" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "key_requirements_api:_details.objective_duplicate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "description_api:_details.description_with_html_removed" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "description_word_count_calculated:_space_separated_word_count" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "description_length_calculated:_character_count" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "has_technical_details_derived:_1_if_description_>_500_chars" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "isxtech_text_analysis:_xtech_mentioned_in_description" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "is_xtech_text_analysis:_xtech_keyword_search_duplicate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "prize_gating_derived:_yes_if_xtech_detected" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "competition_type_derived:_based_on_xtech_and_dp2_detection" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "has_commercial_potential_derived:_1_if_phase3description_exists" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "references_api:_details.referencedocuments_array_formatted" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "reference_docs_api:_details.referencedocuments_duplicate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "reference_count_calculated:_count_of_semicolon_separated_refs" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "has_references_derived:_1_if_references_exist" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "phase_api:_phasehierarchy_parsed_or_default_phase_i" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "phases_available_api:_phasehierarchy.config.displayvalue_joined" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "phase_types_api:_phasehierarchy_parsed_pipe_separated" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "phase_count_calculated:_count_of_phase_types" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "funding_max_text_extraction:_maximum_dollar_amount_found" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "funding_type_text_analysis:_cost_plus_or_fixed_price_keywords" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "pdf_link_generated:_topic_pdf_duplicate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "has_pdf_derived:_1_if_pdf_link_exists" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "has_component_instructions_derived:_1_if_component_link_exists" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "solicitation_instructions_version_api:_baaprefaceuploadtitle" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "tpoc_api:_topicmanagers_where_assignmenttype=tpoc_names_joined" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "tpoc_names_api:_topicmanagers.name_array" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "tpoc_emails_api:_topicmanagers.email_array" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "tpoc_centers_api:_topicmanagers.center_array" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "tpoc_count_calculated:_number_of_tpocs" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "has_tpoc_derived:_1_if_tpoc_exists" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "show_tpoc_api:_showtpoc_boolean" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "tpoc_email_domain_extracted:_domain_from_first_tpoc_email" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "owner_api:_owner_field" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "internal_lead_api:_internallead_field" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "sponsor_component_api:_sponsorcomponent_or_component_fallback" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "evaluation_weights_api:_evaluationweights_or_evaluationcriteria" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "selection_criteria_api:_selectioncriteria" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "has_evaluation_criteria_derived:_1_if_evaluation_weights_exist" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "historical_awards_api:_historicalawards" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "previous_awards_count_api:_previousawardscount" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "success_rate_api:_successrate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "year_system:_current_year" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "solicitation_year_extracted:_year_from_cyclename_using_regex" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "program_year_api:_programyear" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "fiscal_year_calculated:_based_on_oct_1_fiscal_year_start" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "quarter_calculated:_calendar_quarter_from_topicstartdate" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "baa_preface_upload_id_api:_baaprefaceuploadid" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "baa_preface_title_api:_baaprefaceuploadtitle" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "is_release_preface_api:_isreleasepreface_boolean" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "baa_files_count_calculated:_length_of_baainstructions_array" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "has_baa_instructions_derived:_1_if_baainstructions_exists" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "applicable_actions_api:_applicableactions_array_joined" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "actions_count_calculated:_length_of_applicableactions" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "is_active_api:_isactive_boolean" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "is_archived_api:_isarchived_boolean" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "is_draft_api:_isdraft_boolean" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "is_published_api:_ispublished_boolean" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "allow_proposal_submission_api:_allowproposalsubmission_boolean" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "is_open_for_submission_derived:_1_if_topicstatus_is_open" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "proposal_requirements_api:_proposalrequirements" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "submission_instructions_api:_submissioninstructions" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "eligibility_requirements_api:_eligibilityrequirements" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "information_quality_calculated:_based_on_key_field_lengths" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "data_completeness_score_calculated:_percentage_of_filled_fields" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "last_scraped_system:_current_timestamp_eastern" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "search_tags_generated:_component,_program,_status_combined" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "category_tags_text_analysis:_tech_categories_from_keywords" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "priority_score_calculated:_multi_factor_scoring_algorithm" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "relevance_score_user_defined:_empty_for_custom_scoring" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "record_id_generated:_topiccode_topicid_first_8_chars" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "unique_id_generated:_cyclename_topiccode" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "tracking_number_api:_trackingnumber_if_exists" TEXT;
ALTER TABLE sbir_database ADD COLUMN IF NOT EXISTS "version_api:_version_or_default_1" TEXT;

-- Verify the table structure
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'sbir_database' 
ORDER BY ordinal_position;
